<%# The Calendar View (Agenda, Week views) %>
<% 
    let styles = ["css/dashboard.css"],
        title = "Dashboard",
        beforeJS = [
          { src: "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js" },
          { src: "https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js" },
        ],
        afterJS = [
        { src: "/js/dashboard/profile.js" },
        { src: "/js/dashboard/import-gcal.js" },
        { src: "/js/dashboard/sync.js" },
          { src: "/js/dashboard/calendar.js" },
        ];
%>
<%- include partials/header.ejs %>
<div id="container">
    <aside id="small">
        <section id="sidebar-calendar"></section>
        <section id="h-profile-container" class="mb-3">
            <% if (!profile) { %>
            <h3>Connect your Habitica account</h3>
            <p class="mb-3">Google Calendar events won't show up until you've entered your Habitica User ID and API key.
            </p>
            <a class="btn btn-primary" href="/settings">Go to Settings</a>

            <% } else { // profile exists! %>
            <h3 class="mb-0"><%= profile.profile.name %></h3>

            <p class="label mb-3">Level
                <span class="level"><%= profile.stats.lvl %></span>&nbsp;&bull;&nbsp;<span
                    class="class"><%= profile.stats.class %></span>
            </p>

            <div class="mb-3" id="stats-bars-container">
                <div class="stats-bar-container">
                    <svg id="health-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path
                            d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z" />
                    </svg>
                    <div id="health-bar" class="bar">
                        <div class="progress-bar"
                            style="width: <%= (profile.stats.hp/profile.stats.maxHealth) * 100 %>%;">
                        </div>
                    </div>
                    <span class="label">
                        <span class="health"><%= profile.stats.hp %></span>&nbsp;/&nbsp;<span
                            class="max-health"><%= profile.stats.maxHealth %></span>
                    </span>
                </div>
                <div class="stats-bar-container">
                    <svg id="exp-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path
                            d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z" />
                    </svg>
                    <div id="exp-bar" class="bar">
                        <div class="progress-bar"
                            style="width: <%= (profile.stats.exp/profile.stats.toNextLevel) * 100 %>%;"></div>
                    </div>
                    <span class="label">
                        <span class="exp"><%= profile.stats.exp %></span>&nbsp;/&nbsp;<span
                            class="max-exp"><%= profile.stats.toNextLevel %></span>
                    </span>
                </div>
                <div class="stats-bar-container">
                    <svg id="mana-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="none" d="M0 0h24v24H0V0z" />
                        <path
                            d="M11.57 13.16c-1.36.28-2.17 1.16-2.17 2.41 0 1.34 1.11 2.42 2.49 2.42 2.05 0 3.71-1.66 3.71-3.71 0-1.07-.15-2.12-.46-3.12-.79 1.07-2.2 1.72-3.57 2zM13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM12 20c-3.31 0-6-2.69-6-6 0-1.53.3-3.04.86-4.43 1.01 1.01 2.41 1.63 3.97 1.63 2.66 0 4.75-1.83 5.28-4.43C17.34 8.97 18 11.44 18 14c0 3.31-2.69 6-6 6z" />
                    </svg>
                    <div id="mana-bar" class="bar">
                        <div class="progress-bar" style="width: <%= (profile.stats.mp/profile.stats.maxMP) * 100 %>%;">
                        </div>
                    </div>
                    <span class="label">
                        <span class="mana"><%= profile.stats.mp %></span>&nbsp;/&nbsp;<span
                            class="max-mana"><%= profile.stats.maxMP %></span>
                    </span>
                </div>
            </div><!-- stats-bars-container -->
            
            <!-- Buttons for resting/leaving the tavern -->
            <% let sleepBtnClass = (profile.preferences.sleep) ? "btn btn-danger" : "btn btn-primary",
                    sleepBtnText = (profile.preferences.sleep) ? "Resume Damage" : "Pause Damage";
            %>
            <button id="sleep-btn" class="<%= sleepBtnClass %>">
                <%= sleepBtnText %>
            </button>

            <% } // end else [profile exists] %>
        </section><!-- h-profile-container -->
    </aside>

    <main id="big">
        <section id='main-calendar'></section>
    </main>
</div>

<!-- Modal, will be keep reusing -->
<%- include partials/event-modal.ejs %>

<%- include partials/footer.ejs %>